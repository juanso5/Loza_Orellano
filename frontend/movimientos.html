<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Movimientos — Agrupado</title>

  <!-- Estilos -->
  <link rel="stylesheet" href="styles/movimientos.css">

  <!-- Font Awesome (iconos) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<body>
  <!-- Sidebar (se intenta cargar sidebar.html; si falla, inyecta fallback interno) -->
  <div id="sidebar-container"></div>

  <!-- Main content -->
  <div class="main-content" id="mainContent">
    <header class="page-header">
      <div class="page-left">
        <h1>Movimientos</h1>
      </div>
      <div class="page-right">
        <input id="searchInput" class="search-input" placeholder="Buscar por cliente, especie o cartera..." />
        <button id="openAddBtn" class="btn primary"><i class="fas fa-plus"></i> Agregar Movimiento</button>
      </div>
    </header>

    <!-- Resumen global (sticky/fijo al scrollear) -->
    <div id="summaryBar" class="summary-bar" aria-hidden="false">
      <div class="summary-item">
        <div class="s-label">Clientes</div>
        <div class="s-value" id="summaryClients">0</div>
      </div>
      <div class="summary-item">
        <div class="s-label">Carteras</div>
        <div class="s-value" id="summaryFunds">0</div>
      </div>
      <div class="summary-item">
        <div class="s-label">Especies</div>
        <div class="s-value" id="summarySpecies">0</div>
      </div>
      <div class="summary-item">
        <div class="s-label">Nominal total</div>
        <div class="s-value" id="summaryNominal">$ 0</div>
      </div>
    </div>

    <!-- Contenido principal: acordeones por cliente -->
    <main class="content-area">
      <section id="clientsContainer" class="clients-container" aria-live="polite"></section>

      <section class="last-movements-section">
        <h2>Últimos movimientos</h2>
        <div class="table-wrap">
          <table id="lastMovementsTable" class="table">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Cliente</th>
                <th>Cartera</th>
                <th>Especie</th>
                <th>Tipo</th>
                <th>Nominal</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="lastMovementsTbody"></tbody>
          </table>
        </div>
      </section>
    </main>
  </div>

  <!-- Modal: Agregar / Editar Movimiento -->
  <div class="modal" id="movementModal" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="movementModalTitle">Agregar movimiento</h3>
          <button class="modal-close btn-close" aria-label="Cerrar"><i class="fas fa-times"></i></button>
        </div>

        <form id="movementForm" class="modal-body" autocomplete="off" novalidate>
          <input type="hidden" id="movementId">

          <div class="form-grid">
            <div class="form-group">
              <label for="clienteSelect">Cliente <span class="required">*</span></label>
              <select id="clienteSelect"></select>
              <div class="error-message" id="error-clienteSelect"></div>
            </div>

            <div class="form-group">
              <label for="fondoSelect">Cartera <span class="required">*</span></label>
              <select id="fondoSelect"></select>
              <div class="error-message" id="error-fondoSelect"></div>
            </div>

            <div class="form-group">
              <label for="fechaInput">Fecha y hora <span class="required">*</span></label>
              <input id="fechaInput" type="datetime-local" />
              <div class="error-message" id="error-fechaInput"></div>
            </div>

            <div class="form-group">
              <label for="tipoSelect">Tipo <span class="required">*</span></label>
              <select id="tipoSelect"><option value="Ingreso">Ingreso</option><option value="Egreso">Egreso</option></select>
              <div class="error-message" id="error-tipoSelect"></div>
            </div>

            <div class="form-group">
              <label for="especieSelect">Especie <span class="required">*</span></label>
              <div class="input-with-side">
                <select id="especieSelect"></select>
                <input id="newEspecieInput" class="d-none" placeholder="Nombre nueva especie..." />
              </div>
              <div class="error-message" id="error-especieSelect"></div>
            </div>

            <div class="form-group">
              <label for="nominalInput">Nominal <span class="required">*</span></label>
              <input id="nominalInput" type="number" min="0.0001" step="any" />
              <div class="error-message" id="error-nominalInput"></div>
            </div>

            <div class="form-group">
              <label for="tcInput">Tipo de cambio</label>
              <input id="tcInput" type="number" min="0" step="any" placeholder="1.00" />
              <div class="error-message" id="error-tcInput"></div>
            </div>

            <div class="form-group form-span-2">
              <label for="obsInput">Observaciones</label>
              <textarea id="obsInput" rows="3"></textarea>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn" id="movementCancelBtn">Cancelar</button>
            <button type="button" class="btn save-btn" id="movementSaveBtn">Guardar</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal: Detalle Cliente -->
  <div class="modal" id="clientModal" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="clientModalTitle">Cliente</h3>
          <button class="modal-close btn-close" aria-label="Cerrar"><i class="fas fa-times"></i></button>
        </div>

        <div class="modal-body" id="clientModalBody"></div>

        <div class="modal-footer">
          <button class="btn" id="clientCloseBtn">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Confirm -->
  <div class="modal" id="confirmModal" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="confirmTitle">Confirmar</h3>
        </div>
        <div class="modal-body">
          <p id="confirmMessage">¿Confirmar?</p>
        </div>
        <div class="modal-footer">
          <button class="btn" id="confirmCancelBtn">Cancelar</button>
          <button class="btn primary" id="confirmOkBtn">Confirmar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Script -->
  <script src="components/movimientos.js"></script>
</body>
</html>
